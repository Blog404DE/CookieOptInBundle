class NcoiTrack{constructor(b){this.$=b}track(a,b,c,d){let e=this,f=this.getDefaultUserSettings(a,b);1===a?this.setNewUserSettings(f,d):this.setUserSettings(f,c),e.makeAjax(f,b)}makeAjax(f,h){let c=this.$,d=this;c.ajax({dataType:"json",type:"POST",url:"/cookie/allowed",data:{data:f,isJava:!0},async:!1,success:function(e){if(!e.success)return;let g=e.cookieVersion;d.saveUserSettings(h,JSON.stringify({id:e.id,cookieVersion:g,cookieIds:f.cookieIds,expireTime:e.expireTime,optOut:f.optOut}));let i=Cookies.get(),k=new NcoiTemplate(c),l=e.tools,n=c("body"),a=new NcoiCookie(c);if(null!==l)l.forEach(function(b){i=a.unsetByTechnicalName(i,b.cookieToolsTechnicalName),k.addToolTemplates(b,n)});else{let d=new _NcoiAnalyticsGoogleTemplate(c);d.remove();let a=new _NcoiMatomoTemplate(c);a.remove()}let b=e.otherScripts;null!==b&&b.forEach(function(c){i=a.unsetByTechnicalName(i,c.cookieToolsTechnicalName),k.addOtherScriptTemplate(b,n)}),a.removeCookies(i)}})}getDefaultUserSettings(d,e){let a=this.$,b=a("[data-ncoi-mod-id]").data("ncoi-mod-id");return{id:null,cookieIds:[],modId:b,newConsent:d,storageKey:e,cookieVersion:0}}setNewUserSettings(b,c){let d=this.$;b.newConsent=!0,"default"===c&&(b.optOut=!0);let e=d(".ncoi---table-input");e.each(function(){let c=d(this).prop("checked");d(this).data("cookie-id")&&c&&b.cookieIds.push(d(this).data("cookie-id"))})}setUserSettings(c,a){c.optOut="modified",c.cookieIds=a.cookieIds,c.id=a.id,c.cookieVersion=a.cookieVersion}saveUserSettings(d,e){let a=this.$,b=new NcoiApp(a);b.setLocalStorage(d,e)}}
