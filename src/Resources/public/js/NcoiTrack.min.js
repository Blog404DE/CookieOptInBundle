class NcoiTrack{constructor(a){this.$=a}track(b,c,d,e){let f=this,g=this.getDefaultUserSettings(b,c);1===b?this.setNewUserSettings(g,e):this.setUserSettings(g,d),f.makeAjax(g,c)}makeAjax(h,c){let d=this.$,e=this;d.ajax({dataType:"json",type:"POST",url:"/cookie/allowed",data:{data:h,isJava:!0},async:!1,success:function(g){if(!g.success)return;let i=g.cookieVersion;e.saveUserSettings(c,JSON.stringify({id:g.id,cookieVersion:i,cookieIds:h.cookieIds,expireTime:g.expireTime,optOut:h.optOut}));let j=Cookies.get(),l=new NcoiTemplate(d),n=g.tools,a=d("body"),b=new NcoiCookie(d);if(null!==n)n.forEach(function(d){j=b.unsetByTechnicalName(j,d.cookieToolsTechnicalName),l.addToolTemplates(d,a)});else{let a=new _NcoiAnalyticsGoogleTemplate(d);a.remove();let b=new _NcoiMatomoTemplate(d);b.remove()}let m=g.otherScripts;null!==m&&m.forEach(function(d){j=b.unsetByTechnicalName(j,d.cookieToolsTechnicalName),l.addOtherScriptTemplate(m,a)}),b.removeCookies(j)}})}getDefaultUserSettings(e,a){let b=this.$,c=b("[data-ncoi-mod-id]").data("ncoi-mod-id");return{id:null,cookieIds:[],modId:c,newConsent:e,storageKey:a,cookieVersion:0}}setNewUserSettings(c,d){let e=this.$;c.newConsent=!0,"default"===d&&(c.optOut=!0);let a=e(".ncoi---table-input");a.each(function(){let a=e(this).prop("checked");e(this).data("cookie-id")&&a&&c.cookieIds.push(e(this).data("cookie-id"))})}setUserSettings(a,b){a.optOut="modified",a.cookieIds=b.cookieIds,a.id=b.id,a.cookieVersion=b.cookieVersion}saveUserSettings(e,a){let b=this.$,c=new NcoiApp(b);c.setLocalStorage(e,a)}}
