class NcoiTrack{constructor(b){this.$=b}track(f,g,a,b){let c=this,d=this.getDefaultUserSettings(f,g);1===f?this.setNewUserSettings(d,b):this.setUserSettings(d,a),c.makeAjax(d,g)}makeAjax(b,i){let f=this.$,h=this;f.ajax({dataType:"json",type:"POST",url:"/cookie/allowed",data:{data:b,isJava:!0},async:!1,success:function(c){if(!c.success)return;let d=c.cookieVersion;h.saveUserSettings(i,JSON.stringify({id:c.id,cookieVersion:d,cookieIds:b.cookieIds,expireTime:c.expireTime,optOut:b.optOut}));let e=Cookies.get(),j=new NcoiTemplate(f),m=c.tools,k=f("body"),l=new NcoiCookie(f);if(null!==m)m.forEach(function(b){e=l.unsetByTechnicalName(e,b.cookieToolsTechnicalName),j.addToolTemplates(b,k)});else{let a=new _NcoiAnalyticsGoogleTemplate(f);a.remove();let b=new _NcoiMatomoTemplate(f);b.remove()}let n=c.otherScripts;null!==n&&n.forEach(function(a){e=l.unsetByTechnicalName(e,a.cookieToolsTechnicalName),j.addOtherScriptTemplate(n,k)}),l.removeCookies(e)}})}getDefaultUserSettings(b,c){let d=this.$,e=d("[data-ncoi-mod-id]").data("ncoi-mod-id");return{id:null,cookieIds:[],modId:e,newConsent:b,storageKey:c,cookieVersion:0}}setNewUserSettings(d,a){let e=this.$;d.newConsent=!0,"default"===a&&(d.optOut=!0);let b=e(".ncoi---table-input");b.each(function(){let a=e(this).prop("checked");e(this).data("cookie-id")&&a&&d.cookieIds.push(e(this).data("cookie-id"))})}setUserSettings(a,b){a.optOut="modified",a.cookieIds=b.cookieIds,a.id=b.id,a.cookieVersion=b.cookieVersion}saveUserSettings(b,c){let d=this.$,e=new NcoiApp(d);e.setLocalStorage(b,c)}}
